<!DOCTYPE html>
<html class="light" lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>미디어 창의실 예약</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              display: ["Lexend", "Noto Sans KR", "system-ui", "sans-serif"],
              sans: ["Noto Sans KR", "system-ui", "sans-serif"],
            },
            colors: {
              primary: {
                DEFAULT: "#2563eb",
                soft: "#dbeafe",
              },
              background: {
                light: "#f3f4f6",
                dark: "#020617",
              },
              card: {
                light: "#ffffff",
                dark: "#020617",
              },
              border: "#e5e7eb",
              text: {
                light: "#111827",
                dark: "#e5e7eb",
              },
            },
          },
        },
      };
    </script>

    <style>
      .material-symbols-outlined {
        font-variation-settings:
          "FILL" 0,
          "wght" 500,
          "GRAD" 0,
          "opsz" 24;
      }
    </style>
  </head>

  <body
    class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark"
  >
    <div
      class="relative flex min-h-screen w-full flex-col items-center justify-center p-4 sm:p-6 lg:p-8"
    >
      <div class="w-full max-w-2xl">
        <!-- Header -->
        <header
          class="mb-6 flex items-center justify-between rounded-2xl border border-border bg-card-light/80 p-4 shadow-sm backdrop-blur dark:bg-card-dark/80"
        >
          <div class="flex items-center gap-3">
            <div
              class="inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-primary-soft text-primary"
            >
              <span class="material-symbols-outlined"> gallery_thumbnail </span>
            </div>
            <div>
              <h1 class="text-lg font-semibold leading-tight">
                미디어 창의실 예약
              </h1>
              <p class="mt-0.5 text-xs text-gray-500 dark:text-gray-400">
                이름·학번·날짜·시간을 선택하면 n8n으로 바로 전송됩니다.
              </p>
            </div>
          </div>

          <div
            class="hidden items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-[11px] font-medium text-gray-600 dark:bg-slate-800 dark:text-gray-300 sm:flex"
          >
            <span
              class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-white text-[10px] shadow-sm dark:bg-slate-900"
              >●</span
            >
            실시간 예약 시스템
          </div>
        </header>

        <!-- Card -->
        <main
          class="rounded-2xl border border-border bg-card-light/90 p-5 shadow-lg shadow-slate-900/5 backdrop-blur-md dark:bg-card-dark/90"
        >
          <!-- Status banner -->
          <div
            id="status-banner"
            class="mb-4 hidden items-start gap-3 rounded-xl border px-3.5 py-2.5 text-sm"
          >
            <div
              id="status-icon"
              class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full"
            >
              <span class="material-symbols-outlined text-[18px]">
                info
              </span>
            </div>
            <div class="flex-1">
              <p
                id="status-message"
                class="font-medium text-gray-800 dark:text-gray-100"
              ></p>
              <p
                id="status-sub"
                class="mt-0.5 text-xs text-gray-500 dark:text-gray-400"
              ></p>
            </div>
          </div>

          <!-- Form -->
          <form id="reservation-form" class="space-y-8">
            <div class="grid grid-cols-1 gap-x-6 gap-y-6 md:grid-cols-2">
              <!-- Name -->
              <div class="flex flex-col">
                <label
                  for="name"
                  class="pb-2 text-sm font-medium leading-normal text-gray-800 dark:text-gray-100"
                  >이름 (Name)</label
                >
                <input
                  id="name"
                  name="name"
                  type="text"
                  required
                  placeholder="이름을 입력하세요"
                  class="form-input flex w-full min-w-0 flex-1 rounded-xl border-gray-300 bg-white text-sm shadow-sm outline-none ring-primary-soft placeholder:text-gray-400 focus:border-primary focus:ring-2 dark:border-slate-700 dark:bg-slate-900 dark:text-gray-100"
                />
              </div>

              <!-- Student ID -->
              <div class="flex flex-col">
                <label
                  for="student-id"
                  class="pb-2 text-sm font-medium leading-normal text-gray-800 dark:text-gray-100"
                  >학번 (Student ID)</label
                >
                <input
                  id="student-id"
                  name="student-id"
                  type="text"
                  required
                  placeholder="예: 1416"
                  class="form-input flex w-full min-w-0 flex-1 rounded-xl border-gray-300 bg-white text-sm shadow-sm outline-none ring-primary-soft placeholder:text-gray-400 focus:border-primary focus:ring-2 dark:border-slate-700 dark:bg-slate-900 dark:text-gray-100"
                />
                <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">
                  학번 4자리 정도 형식으로 입력해주세요.
                </p>
              </div>
            </div>

            <!-- Email -->
            <div class="flex flex-col">
              <label
                for="email"
                class="pb-2 text-sm font-medium leading-normal text-gray-800 dark:text-gray-100"
                >이메일 (Email)</label
              >
              <input
                id="email"
                name="email"
                type="email"
                required
                placeholder="학교 이메일을 입력하세요"
                class="form-input flex w-full min-w-0 flex-1 rounded-xl border-gray-300 bg-white text-sm shadow-sm outline-none ring-primary-soft placeholder:text-gray-400 focus:border-primary focus:ring-2 dark:border-slate-700 dark:bg-slate-900 dark:text-gray-100"
              />
              <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">
                예약 결과가 이 주소로 전송됩니다.
              </p>
            </div>

            <!-- Date -->
            <div class="flex flex-col">
              <label
                for="date"
                class="pb-2 text-sm font-medium leading-normal text-gray-800 dark:text-gray-100"
                >날짜 (Date)</label
              >
              <div class="relative">
                <input
                  id="date"
                  name="date"
                  type="date"
                  required
                  class="form-input flex w-full min-w-0 flex-1 rounded-xl border-gray-300 bg-white text-sm shadow-sm outline-none ring-primary-soft placeholder:text-gray-400 focus:border-primary focus:ring-2 dark:border-slate-700 dark:bg-slate-900 dark:text-gray-100"
                />
                <span
                  class="pointer-events-none absolute inset-y-0 right-3 inline-flex items-center justify-center text-gray-400"
                >
                  <span class="material-symbols-outlined text-[18px]">
                    calendar_today
                  </span>
                </span>
              </div>
            </div>

            <!-- Room & Time -->
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
              <!-- Room radio -->
              <fieldset>
                <legend
                  class="mb-2 text-sm font-medium text-gray-800 dark:text-gray-100"
                >
                  창의실 (Room)
                </legend>
                <div class="space-y-2 rounded-xl bg-gray-50 p-3 dark:bg-slate-900">
                  <label
                    class="flex cursor-pointer items-center justify-between rounded-lg px-2 py-2 text-sm hover:bg-white hover:shadow-sm dark:hover:bg-slate-800"
                  >
                    <div class="flex items-center gap-2">
                      <input
                        id="room1"
                        name="creative-room"
                        type="radio"
                        value="1실"
                        class="h-4 w-4 border-gray-300 text-primary focus:ring-primary"
                        checked
                      />
                      <span class="font-medium">1실</span>
                    </div>
                    <span
                      class="rounded-full bg-primary-soft px-2 py-0.5 text-[11px] font-medium text-primary"
                      >추천</span
                    >
                  </label>

                  <label
                    class="flex cursor-pointer items-center rounded-lg px-2 py-2 text-sm hover:bg-white hover:shadow-sm dark:hover:bg-slate-800"
                  >
                    <input
                      id="room2"
                      name="creative-room"
                      type="radio"
                      value="2실"
                      class="h-4 w-4 border-gray-300 text-primary focus:ring-primary"
                    />
                    <span class="ml-2 font-medium">2실</span>
                  </label>
                </div>
              </fieldset>

              <!-- Time select -->
              <div class="flex flex-col">
                <label
                  for="time"
                  class="pb-2 text-sm font-medium leading-normal text-gray-800 dark:text-gray-100"
                  >시간 (Time)</label
                >
                <select
                  id="time"
                  name="time"
                  required
                  class="form-select rounded-xl border-gray-300 bg-white text-sm shadow-sm outline-none ring-primary-soft focus:border-primary focus:ring-2 dark:border-slate-700 dark:bg-slate-900 dark:text-gray-100"
                >
                  <option value="">시간을 선택하세요</option>
                  <option value="자습1교시">자습 1교시</option>
                  <option value="자습2교시">자습 2교시</option>
                  <option value="야자1교시">야자 1교시</option>
                  <option value="야자2교시">야자 2교시</option>
                </select>
                <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">
                  이미 예약된 시간은 n8n에서 자동으로 막아줍니다.
                </p>
              </div>
            </div>

            <!-- Summary -->
            <div
              class="rounded-xl border border-dashed border-gray-300 bg-gray-50 px-3.5 py-3 text-xs text-gray-600 dark:border-slate-700 dark:bg-slate-900 dark:text-gray-300"
            >
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span
                    class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-white text-[12px] shadow-sm dark:bg-slate-800"
                  >
                    i
                  </span>
                  <p>
                    위 정보는
                    <span class="font-semibold">n8n 예약 워크플로우</span>로
                    전송됩니다.
                  </p>
                </div>
                <span class="hidden text-[11px] text-gray-400 sm:inline">
                  저장: DataTable “미디어 창의실”
                </span>
              </div>
            </div>

            <!-- Submit -->
            <button
              type="submit"
              id="submit-btn"
              class="flex w-full items-center justify-center rounded-full bg-primary px-4 py-2.5 text-sm font-semibold text-white shadow-md shadow-primary/30 transition hover:bg-blue-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 dark:ring-offset-slate-900"
            >
              <span class="material-symbols-outlined mr-1.5 text-[18px]">
                send
              </span>
              예약 신청 (Submit)
            </button>
          </form>
        </main>
      </div>
    </div>

    <script>
      // TODO: 여기를 실제 n8n Webhook URL로 교체
      // 예: "https://naplace-n8n.org/webhook/9eb4ab1b-25d4-445b-bdc1-ed7a9bf07d3a"
      const N8N_WEBHOOK_URL =
        "https://YOUR_N8N_DOMAIN/webhook/9eb4ab1b-25d4-445b-bdc1-ed7a9bf07d3a";

      const form = document.getElementById("reservation-form");
      const submitBtn = document.getElementById("submit-btn");
      const statusBanner = document.getElementById("status-banner");
      const statusMsg = document.getElementById("status-message");
      const statusSub = document.getElementById("status-sub");
      const statusIcon = document.getElementById("status-icon");

      function showStatus(type, message, sub) {
        statusBanner.classList.remove("hidden");
        statusBanner.classList.remove(
          "border-blue-200",
          "bg-blue-50",
          "border-green-200",
          "bg-green-50",
          "border-red-200",
          "bg-red-50"
        );
        statusIcon.classList.remove(
          "bg-blue-100",
          "text-blue-600",
          "bg-green-100",
          "text-green-600",
          "bg-red-100",
          "text-red-600"
        );

        if (type === "info") {
          statusBanner.classList.add("border-blue-200", "bg-blue-50");
          statusIcon.classList.add("bg-blue-100", "text-blue-600");
        } else if (type === "success") {
          statusBanner.classList.add("border-green-200", "bg-green-50");
          statusIcon.classList.add("bg-green-100", "text-green-600");
        } else if (type === "error") {
          statusBanner.classList.add("border-red-200", "bg-red-50");
          statusIcon.classList.add("bg-red-100", "text-red-600");
        }

        statusMsg.textContent = message;
        statusSub.textContent = sub || "";
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const payload = {
          name: formData.get("name")?.trim(),
          "student-id": formData.get("student-id")?.trim(),
          email: formData.get("email")?.trim(),
          date: formData.get("date"),
          "creative-room": formData.get("creative-room"),
          time: formData.get("time"),
        };

        // 간단 검증
        if (
          !payload.name ||
          !payload["student-id"] ||
          !payload.email ||
          !payload.date ||
          !payload["creative-room"] ||
          !payload.time
        ) {
          showStatus(
            "error",
            "모든 필드를 정확히 입력해주세요.",
            "이름, 학번, 이메일, 날짜, 창의실, 시간 중 누락된 값이 있습니다."
          );
          return;
        }

        submitBtn.disabled = true;
        submitBtn.classList.add("opacity-80", "cursor-wait");
        submitBtn.innerHTML =
          '<span class="material-symbols-outlined mr-1.5 text-[18px] animate-spin"> progress_activity </span> 전송 중...';

        showStatus(
          "info",
          "예약 요청을 전송하는 중입니다.",
          "잠시만 기다려 주세요. n8n에서 중복 여부를 확인한 뒤 이메일을 발송합니다."
        );

        try {
          const res = await fetch(N8N_WEBHOOK_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          if (!res.ok) {
            throw new Error("HTTP " + res.status);
          }

          showStatus(
            "success",
            "예약 요청이 정상적으로 전송되었습니다.",
            "곧 학교 이메일로 예약 성공 또는 중복 안내 메일이 도착합니다."
          );
          form.reset();
        } catch (err) {
          console.error(err);
          showStatus(
            "error",
            "전송 중 오류가 발생했습니다.",
            "네트워크 상태를 확인하거나, 잠시 후 다시 시도해주세요."
          );
        } finally {
          submitBtn.disabled = false;
          submitBtn.classList.remove("opacity-80", "cursor-wait");
          submitBtn.innerHTML =
            '<span class="material-symbols-outlined mr-1.5 text-[18px]"> send </span>예약 신청 (Submit)';
        }
      });
    </script>
  </body>
</html>
